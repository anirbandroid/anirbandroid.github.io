<!DOCTYPE html>
<html>
<head>
    <title>Select Menu</title>
	<meta charset="utf-8" http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <link rel="apple-touch-icon" sizes="76x76" href="assets/images/favicon2.ico" />
    <link rel="icon" type="image/ico" href="assets/images/favicon2.ico" />
    <meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0' name='viewport' />
    <link href="assets/css/bootstrap.min.css" rel="stylesheet" />
    <link href="assets/css/sweetalert/sweetalert.css" rel="stylesheet" />
    <link href="assets/css/fontawesome/all.min.css" rel="stylesheet" />
    <link href="assets/css/menu.css" rel="stylesheet" />
</head>
<body>
    <div class="container" style="margin-top:0%">
        <div class="row">
            <div class="col-md-12 text-center">
                <img class="imgLogo" alt="" />
            </div>
        </div>
        <div class="row">
            <div class="col-md-12">
                <fieldset class="scheduler-border">
                    <legend class="textLegend">
                        Mocktails & Hot Beverages&nbsp;<i class='fas fa-cocktail' style='color: #75c8f5'></i>
                    </legend>
                    <div class="row" id="divMocktailsBV"></div>
                </fieldset>
            </div>
        </div>
        <div class="row">
            <div class="col-md-12">
                <fieldset class="scheduler-border">
                    <legend class="textLegend">
                        Appetizer Veg&nbsp;<i class='fas fa-carrot iconStyle' style='color: #3DC53B;'></i>
                    </legend>
                    <div class="row" id="divVegStarter"></div>
                </fieldset>
            </div>
        </div>
        <div class="row">
            <div class="col-md-12">
                <fieldset class="scheduler-border">
                    <legend class="textLegend">
                        Appetizer Non-Veg
                        &nbsp;<i class='fa fa-fish' style='color: #f65757'></i>
                        &nbsp;<i class='fa fa-bone' style='color: #e90f0f'></i>
                    </legend>
                    <div class="row" id="divNonVegStarter"></div>
                </fieldset>
            </div>
        </div>
        <div class="row">
            <div class="col-md-12">
                <fieldset class="scheduler-border">
                    <legend class="textLegend">
                        Desi Chaat&nbsp;<i class='fa fa-hamburger' style='color: #fbaa3b'></i>
                    </legend>
                    <div class="row" id="divChaat"></div>                    
                </fieldset>
            </div>
        </div>
        <div class="row">
            <div class="col-md-12">
                <fieldset class="scheduler-border">
                    <legend class="textLegend">
                        Desert&nbsp;<i class='fa fa-ice-cream' style='color: #dc87be'></i>
                    </legend>
                    <div class="row" id="divDesert"></div>
                </fieldset>
            </div>
        <input type="button" class="btn btn-info btnOrder shaky-btn" id="btnOrder" value="ORDER NOW" />
    </div>
    <script src="assets/script/jquery.min.js"></script>
    <script src="assets/script/bootstrap.min.js"></script>
    <script src="assets/css/sweetalert/sweetalert.min.js"></script>
    <script src="assets/css/fontawesome/all.min.js"></script>
    <script src="data/data.js"></script>
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/11.1.0/firebase-app.js'

        // If you enabled Analytics in your project, add the Firebase SDK for Google Analytics
        import { getAnalytics } from 'https://www.gstatic.com/firebasejs/11.1.0/firebase-analytics.js'

        import { getAuth } from 'https://www.gstatic.com/firebasejs/11.1.0/firebase-auth.js'
        import { getFirestore, doc, getDoc, setDoc, collection, query, where, getDocs } from 'https://www.gstatic.com/firebasejs/11.1.0/firebase-firestore.js'

        const firebaseConfig = {
            apiKey: "AIzaSyBkIVRoJTqEtwKKsOB7dMGuKauJ_den2ew",
            authDomain: "test-5acde.firebaseapp.com",
            projectId: "test-5acde",
            storageBucket: "test-5acde.firebasestorage.app",
            messagingSenderId: "801361787817",
            appId: "1:801361787817:web:aa053f70023512f96da2b8",
            measurementId: "G-G73MHFD18Y"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore();

        const docRef = doc(db, "orders", "AIpXtsVGDBJHK2ZnKJUD");
        try {
            const docSnap = await getDoc(docRef);
            //const snapshot = await firebase.firestore().collection('orders').get();
            if(docSnap.exists()) {
                console.log(docSnap.data());
            } else {
            console.log("Document does not exist")
        }

        const q = query(collection(db, "orders"));//, where("table_id", "==", 5)
        
        const querySnapshot = await getDocs(q);
            querySnapshot.forEach((doc) => {
            // doc.data() is never undefined for query doc snapshots
            console.log("----------------------");
            console.log(doc.data());
        });

        } catch(error) {
        console.log(error)
        }

        $('#btnOrder').click(function(){
            var tableId = $.urlParam('tableId'); 
            var orderId = Generator() + "_" + tableId;
            const test = setDoc(doc(db, "orders", orderId), {
                items: itemArr + "",
                status: "ordered",
                table_id: tableId
            });
            swal("Great choice!", "Your order has been placed successfully!!", "success");
            itemArr = null;
        });
    </script>
    <script>
        //createMainDivs();
        function createMainDivs() {
            for (var i = 1; i <= menu.length/2; i++) {
                var lDiv = "<div class='row'>";
                for (var j = 1; j <= 2; j++) {
                    lDiv += "<div class='col-md-6'><fieldset class='scheduler-border>";
                    lDiv += "<legend class='textLegend'>" + menu[i * j].name + "</legend>";
                    lDiv += "<div class='row' id='divDesert'></div></fieldset></div>";
                }
                lDiv += "</div>";
                $("#test").append(lDiv);
            }
        }

        function createDivs(dataset, divID) {
            $(jQuery.parseJSON(JSON.stringify(dataset))).each(function () {
                var lDiv = "<div class='row'><div class='col-md-1'></div><div class='col-md-11'>";
                lDiv += "<div class='form-check'>";
                lDiv += "<input class='form-check-input style='cursor:pointer' name='chkMenu' type='checkbox' value='" + this.id + "'id='" + this.id + "'>&nbsp;";
                lDiv += "<label class='form-check-label labelHeader' style='cursor:pointer' for='" + this.id + "'>" + this.name + "</label>";
                lDiv += "&nbsp;<img alt='' src='assets/images/" + this.icon + "' title='" + this.title + "'/></div></div></div>";
                $("#" + divID).append(lDiv);
            });
        }

        $(document).ready(function () {
            createDivs(mocktailsbv, "divMocktailsBV");
            createDivs(chat, "divChaat");
            createDivs(starterVeg, "divVegStarter");
            createDivs(starterNonVeg, "divNonVegStarter");
            createDivs(desert, "divDesert");
            console.log(desert);
        });
        
        let itemArr = [];
        $(function () {
            $(".form-check input").change(function () {
                const max = 5;
                let itemIds = [];
                let itemTexts = [];
                $("input:checkbox[name=chkMenu]:checked").each(function () {
                    itemIds.push($(this).val());
                    itemTexts.push($(this).next("label").text());
                    if (itemIds.length > max) {
                        $(this).prop("checked", false);
                        itemTexts.pop();
                        swal("You've a great taste bud!", "But first proceed with " + max + " of your best choices to preapare, you can order again!!", "info");
                    } else {
                        itemArr = itemTexts;
                        $('#btnOrder').focus();
                    }
                });
            });
        });

        $.urlParam = function(name){
            var results = new RegExp('[\?&]' + name + '=([^&#]*)').exec(window.location.href);
            if (results==null) {
            return null;
            }
            return decodeURI(results[1]) || 0;
        }

        function Generator() {
            return Math.floor(Math.random() * 26) + Date.now();
        };
    </script>
</body>
</html>
